/**
 * @version  OpenSeadragon 0.9.64
 *
 * @fileOverview 
 * <h2>
 * <strong>
 * OpenSeadragon - Javascript Deep Zooming
 * </strong>
 * </h2> 
 * <p>
 * OpenSeadragon is provides an html interface for creating 
 * deep zoom user interfaces.  The simplest examples include deep 
 * zoom for large resolution images, and complex examples include
 * zoomable map interfaces driven by SVG files.
 * </p>
 * 
 * @author <br/>(c) 2011, 2012 Christopher Thatcher 
 * @author <br/>(c) 2010 OpenSeadragon Team 
 * @author <br/>(c) 2010 CodePlex Foundation 
 * 
 * <p>
 * <strong>Original license preserved below: </strong><br/>
 * <pre>
 * ----------------------------------------------------------------------------
 * 
 *  License: New BSD License (BSD)
 *  Copyright (c) 2010, OpenSeadragon
 *  All rights reserved.
 * 
 *  Redistribution and use in source and binary forms, with or without 
 *  modification, are permitted provided that the following conditions are met:
 *  
 *  * Redistributions of source code must retain the above copyright notice, this 
 *    list of conditions and the following disclaimer.
 *  
 *  * Redistributions in binary form must reproduce the above copyright notice, 
 *    this list of conditions and the following disclaimer in the documentation 
 *    and/or other materials provided with the distribution.
 * 
 *  * Neither the name of OpenSeadragon nor the names of its contributors may be 
 *    used to endorse or promote products derived from this software without 
 *    specific prior written permission.
 * 
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
 *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE 
 *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 *  POSSIBILITY OF SUCH DAMAGE.
 * 
 * ---------------------------------------------------------------------------
 * </pre>
 * </p>
 * <p>
 * <strong> Work done by Chris Thatcher adds an MIT license </strong><br/>
 * <pre>
 * ----------------------------------------------------------------------------
 * (c) Christopher Thatcher 2011, 2012. All rights reserved.
 * 
 * Licensed with the MIT License
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * ---------------------------------------------------------------------------
 * </pre>
 * </p>
 **/

OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},function(e){var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,r=Object.prototype.hasOwnProperty,i=Array.prototype.push,s=Array.prototype.slice,o=String.prototype.trim,u=Array.prototype.indexOf;e.isFunction=function(t){return e.type(t)==="function"},e.isArray=Array.isArray||function(t){return e.type(t)==="array"},e.isWindow=function(e){return e&&typeof e=="object"&&"setInterval"in e},e.type=function(e){return e==null?String(e):t[n.call(e)]||"object"},e.isPlainObject=function(t){if(!t||OpenSeadragon.type(t)!=="object"||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in t);return n===undefined||r.call(t,n)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0}}(OpenSeadragon),function(e){function o(e,t){return t&&e!=document.body?document.body:e.offsetParent}function u(t,n){var r,i,s=null;if(!t)throw new Error(e.getString("Errors.Security"));if(t.status!==200&&t.status!==0)throw r=t.status,i=r==404?"Not Found":t.statusText,new Error(e.getString("Errors.Status",r,i));return t.responseXML&&t.responseXML.documentElement?s=t.responseXML:t.responseText&&(s=e.parseXml(t.responseText)),a(s,n)}function a(t,n){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var r=t.documentElement,i=r.tagName;if(i=="Image")try{return f(r,n)}catch(s){throw s instanceof Error?s:new Error(e.getString("Errors.Dzi"))}else{if(i=="Collection")throw new Error(e.getString("Errors.Dzc"));if(i=="Error")return c(r)}throw new Error(e.getString("Errors.Dzi"))}function f(t,n){var r=t.getAttribute("Format"),i=t.getElementsByTagName("Size")[0],s=t.getElementsByTagName("DisplayRect"),o=parseInt(i.getAttribute("Width")),u=parseInt(i.getAttribute("Height")),a=parseInt(t.getAttribute("TileSize")),f=parseInt(t.getAttribute("Overlap")),l=[],c,h,p;if(!imageFormatSupported(r))throw new Error(e.getString("Errors.ImageFormat",r.toUpperCase()));for(p=0;p<s.length;p++)c=s[p],h=c.getElementsByTagName("Rect")[0],l.push(new e.DisplayRect(parseInt(h.getAttribute("X")),parseInt(h.getAttribute("Y")),parseInt(h.getAttribute("Width")),parseInt(h.getAttribute("Height")),0,parseInt(c.getAttribute("MaxLevel"))));return new e.DziTileSource(o,u,a,f,n,r,l)}function l(t,n){var r=t.Format,i=t.Size,s=t.DisplayRect||[],o=parseInt(i.Width),u=parseInt(i.Height),a=parseInt(t.TileSize),f=parseInt(t.Overlap),l=[],c,h;if(!imageFormatSupported(r))throw new Error(e.getString("Errors.ImageFormat",r.toUpperCase()));for(h=0;h<s.length;h++)c=s[h].Rect,l.push(new e.DisplayRect(parseInt(c.X),parseInt(c.Y),parseInt(c.Width),parseInt(c.Height),0,parseInt(c.MaxLevel)));return new e.DziTileSource(o,u,a,f,n,r,l)}function c(e){var t=e.getElementsByTagName("Message")[0],n=t.firstChild.nodeValue;throw new Error(n)}e.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=arguments.length,a=!1,f=1;typeof o=="boolean"&&(a=o,o=arguments[1]||{},f=2),typeof o!="object"&&!OpenSeadragon.isFunction(o)&&(o={}),u===f&&(o=this,--f);for(;f<u;f++)if((e=arguments[f])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;a&&r&&(OpenSeadragon.isPlainObject(r)||(i=OpenSeadragon.isArray(r)))?(i?(i=!1,s=n&&OpenSeadragon.isArray(n)?n:[]):s=n&&OpenSeadragon.isPlainObject(n)?n:{},o[t]=OpenSeadragon.extend(a,s,r)):r!==undefined&&(o[t]=r)}return o},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,debugMode:!0,animationTime:1.5,blendTime:.1,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,wrapHorizontal:!1,wrapVertical:!1,panHorizontal:!0,panVertical:!0,visibilityRatio:.5,springStiffness:5,clickTimeThreshold:200,clickDistThreshold:5,zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:2,showNavigationControl:!0,showSequenceControl:!0,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!0,navigatorElement:null,navigatorHeight:null,navigatorWidth:null,navigatorPosition:null,navigatorSizeRatio:.25,preserveViewport:!1,defaultZoomLevel:0,onPageChange:null,minPixelRatio:.5,imageLoaderLimit:0,maxImageCacheCount:200,minZoomImageRatio:.8,maxZoomPixelRatio:2,prefixUrl:null,navImages:{zoomIn:{REST:"/images/zoomin_rest.png",GROUP:"/images/zoomin_grouphover.png",HOVER:"/images/zoomin_hover.png",DOWN:"/images/zoomin_pressed.png"},zoomOut:{REST:"/images/zoomout_rest.png",GROUP:"/images/zoomout_grouphover.png",HOVER:"/images/zoomout_hover.png",DOWN:"/images/zoomout_pressed.png"},home:{REST:"/images/home_rest.png",GROUP:"/images/home_grouphover.png",HOVER:"/images/home_hover.png",DOWN:"/images/home_pressed.png"},fullpage:{REST:"/images/fullpage_rest.png",GROUP:"/images/fullpage_grouphover.png",HOVER:"/images/fullpage_hover.png",DOWN:"/images/fullpage_pressed.png"},previous:{REST:"/images/previous_rest.png",GROUP:"/images/previous_grouphover.png",HOVER:"/images/previous_hover.png",DOWN:"/images/previous_pressed.png"},next:{REST:"/images/next_rest.png",GROUP:"/images/next_grouphover.png",HOVER:"/images/next_hover.png",DOWN:"/images/next_pressed.png"}}},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){return arguments===undefined&&(arguments=[]),t.apply(e,arguments)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e},getElementPosition:function(t){var n=new e.Point,r,i;t=e.getElement(t),r=e.getElementStyle(t).position=="fixed",i=o(t,r);while(i)n.x+=t.offsetLeft,n.y+=t.offsetTop,r&&(n=n.plus(e.getPageScroll())),t=i,r=e.getElementStyle(t).position=="fixed",i=o(t,r);return n},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getEvent:function(t){return t?e.getEvent=function(e){return e}:e.getEvent=function(e){return window.event},e.getEvent(t)},getMousePosition:function(t){if(typeof t.pageX=="number")e.getMousePosition=function(t){var n=new e.Point;return t=e.getEvent(t),n.x=t.pageX,n.y=t.pageY,n};else{if(typeof t.clientX!="number")throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var n=new e.Point;return t=e.getEvent(t),n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,n}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},n=document.body||{};return typeof window.pageXOffset=="number"?e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)}:n.scrollLeft||n.scrollTop?e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)}:t.scrollLeft||t.scrollTop?e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}:e.getPageScroll=function(){return new e.Point(0,0)},e.getPageScroll()},getWindowSize:function(){var t=document.documentElement||{},n=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!n.clientWidth&&!n.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){var n=e.makeNeutralElement("div"),r=[],i,s;t=e.getElement(t),r.push('<div style="display:table; height:100%; width:100%;'),r.push("border:none; margin:0px; padding:0px;"),r.push('#position:relative; overflow:hidden; text-align:left;">'),r.push('<div style="#position:absolute; #top:50%; width:100%; '),r.push("border:none; margin:0px; padding:0px;"),r.push('display:table-cell; vertical-align:middle;">'),r.push('<div style="#position:relative; #top:-50%; width:100%; '),r.push("border:none; margin:0px; padding:0px;"),r.push('text-align:center;"></div></div></div>'),n.innerHTML=r.join(""),n=n.firstChild,i=n,s=n.getElementsByTagName("div");while(s.length>0)i=s[0],s=i.getElementsByTagName("div");return i.appendChild(t),n},makeNeutralElement:function(e){var t=document.createElement(e),n=t.style;return n.background="transparent none",n.border="none",n.margin="0px",n.padding="0px",n.position="static",t},makeTransparentImage:function(t){return e.makeTransparentImage=function(t){var n=e.makeNeutralElement("img");return n.src=t,n},e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<7&&(e.makeTransparentImage=function(t){var n=e.makeNeutralElement("img"),r=null;return r=e.makeNeutralElement("span"),r.style.display="inline-block",n.onload=function(){r.style.width=r.style.width||n.width+"px",r.style.height=r.style.height||n.height+"px",n.onload=null,n=null},n.src=t,r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",r}),e.makeTransparentImage(t)},setElementOpacity:function(t,n,r){var i,s,o;t=e.getElement(t),r&&!e.Browser.alpha&&(n=Math.round(n)),n<1?t.style.opacity=n:t.style.opacity="";if(n==1){prevFilter=t.style.filter||"",t.style.filter=prevFilter.replace(/alpha\(.*?\)/g,"");return}s=Math.round(100*n),o=" alpha(opacity="+s+") ";try{t.filters&&t.filters.alpha?t.filters.alpha.opacity=s:t.style.filter+=o}catch(u){t.style.filter+=o}},addEvent:function(t,n,r,i){t=e.getElement(t);if(t.addEventListener)e.addEvent=function(t,n,r,i){t=e.getElement(t),t.addEventListener(n,r,i)};else{if(!t.attachEvent)throw new Error("Unable to attach event handler, no known technique.");e.addEvent=function(t,n,r,i){t=e.getElement(t),t.attachEvent("on"+n,r),i&&t.setCapture&&t.setCapture()}}return e.addEvent(t,n,r,i)},removeEvent:function(t,n,r,i){t=e.getElement(t);if(t.removeEventListener)e.removeEvent=function(t,n,r,i){t=e.getElement(t),t.removeEventListener(n,r,i)};else{if(!t.detachEvent)throw new Error("Unable to detach event handler, no known technique.");e.removeEvent=function(t,n,r,i){t=e.getElement(t),t.detachEvent("on"+n,r),i&&t.releaseCapture&&t.releaseCapture()}}return e.removeEvent(t,n,r,i)},cancelEvent:function(t){t=e.getEvent(t),t.preventDefault?e.cancelEvent=function(e){e.preventDefault()}:e.cancelEvent=function(t){t=e.getEvent(t),t.cancel=!0,t.returnValue=!1},e.cancelEvent(t)},stopEvent:function(t){t=e.getEvent(t),t.stopPropagation?e.stopEvent=function(e){e.stopPropagation()}:e.stopEvent=function(t){t=e.getEvent(t),t.cancelBubble=!0},e.stopEvent(t)},createCallback:function(e,t){var n=[],r;for(r=2;r<arguments.length;r++)n.push(arguments[r]);return function(){var r=n.concat([]),i;for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}},getUrlParameter:function(e){var t=r[e];return t?t:null},createAjaxRequest:function(){var n;if(window.ActiveXObject)for(i=0;i<t.length;i++)try{n=new ActiveXObject(t[i]),e.createAjaxRequest=function(){return new ActiveXObject(t[i])};break}catch(r){continue}else window.XMLHttpRequest&&(e.createAjaxRequest=function(){return new XMLHttpRequest},n=new XMLHttpRequest);if(!n)throw new Error("Browser doesn't support XMLHttpRequest.");return n},makeAjaxRequest:function(t,n){var r=!0,i=e.createAjaxRequest(),s,o,u;e.isPlainObject(t)?o.async=o.async||r:o={url:t,async:e.isFunction(n),success:n,error:null},o.async&&(i.onreadystatechange=function(){i.readyState==4&&(i.onreadystatechange=new function(){},o.success(i))});try{i.open("GET",o.url,o.async),i.send(null)}catch(a){e.console.log("%s while making AJAX request: %s",a.name,a.message),i.onreadystatechange=null,i=null,o.error&&e.isFunction(o.error)&&o.error(i)}return!o.async&&e.isFunction(o.success)&&o.success(i),o.async?null:i},jsonp:function(t){var n,r=t.url,i=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+ +(new Date),o=window[s],u="$1"+s+"$2",a=t.param||"callback",f=t.callback;r=r.replace(/(\=)\?(&|$)|\?\?/i,u),r+=(/\?/.test(r)?"&":"?")+a+"="+s,window[s]=function(t){if(!o)try{delete window[s]}catch(n){}else window[s]=o;f&&e.isFunction(f)&&f(t)},n=document.createElement("script");if(undefined!==t.async||!1!==t.async)n.async="async";t.scriptCharset&&(n.charset=t.scriptCharset),n.src=r,n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=undefined},i.insertBefore(n,i.firstChild)},createFromDZI:function(t,n,r){function m(e,t){try{return e(t,d)}catch(n){if(i)return null;throw n}}var i=typeof n=="function",s=t.substring(0,1)!="<"&&t.substring(0,1)!="{"?t:null,o=s?null:t,f=null,c,h,p,d,v;return r?d=r+"/_files/":s&&(c=s.split("/"),h=c[c.length-1],h.match(/_dzi\.js$/)&&(h=h.replace("_dzi.js",".js")),p=h.lastIndexOf("."),p>-1&&(c[c.length-1]=h.slice(0,p)),d=c.join("/")+"_files/"),i?(o?window.setTimeout(function(){var t=m(a,e.parseXml(xmlString));n(t,f)},1):s.match(/_dzi\.js$/)?(v=s.split("/").pop().replace(".js",""),e.jsonp({url:s,callbackName:v,callback:function(e){var t=m(l,e.Image);n(t)}})):e.makeAjaxRequest(s,function(e){var t=m(u,e);n(t,f)}),null):o?m(a,e.parseXml(o)):m(u,e.makeAjaxRequest(s))},parseXml:function(t){if(window.ActiveXObject)e.parseXml=function(e){var t=null,n;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t};else{if(!window.DOMParser)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t=null,n;return n=new DOMParser,t=n.parseFromString(e,"text/xml"),t}}return e.parseXml(t)},imageFormatSupported:function(e){return e=e?e:"",!!n[e.toLowerCase()]}}),e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var t=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},r={};(function(){var t=navigator.appName,n=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":!window.addEventListener||(i.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0&&(e.Browser.vendor=i.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(n)}var s=window.location.search.substring(1),o=s.split("&"),u,a,f;for(f=0;f<o.length;f++)u=o[f],a=u.indexOf("="),a>0&&(r[u.substring(0,a)]=decodeURIComponent(u.substring(a+1)));e.Browser.alpha=!(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9||e.Browser.vendor==e.BROWSERS.CHROME&&e.Browser.version<2)})();var s=function(e){};e.console=window.console||{log:s,debug:s,info:s,warn:s,error:s}}(OpenSeadragon),function(e){e.EventHandler=function(){this.events={}},e.EventHandler.prototype={addHandler:function(t,n){var r=this.events[t];r||(this.events[t]=r=[]),n&&e.isFunction(n)&&(r[r.length]=n)},removeHandler:function(e,t){var n=this.events[e];if(!n)return},getHandler:function(e){var t=this.events[e];return!t||!t.length?null:(t=t.length===1?[t[0]]:Array.apply(null,t),function(e,n){var r,i=t.length;for(r=0;r<i;r++)t[r]&&t[r](e,n)})},raiseEvent:function(e,t){var n=this.getHandler(e);n&&(t||(t=new Object),n(this,t))}}}(OpenSeadragon),function(e){function o(t){var n=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],i=s[t.hash],o,u;if(!i.tracking){for(u=0;u<n.length;u++)o=n[u],e.addEvent(t.element,o,i[o],!1);i.tracking=!0,r[t.hash]=t}}function u(t){var n=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],i=s[t.hash],o,u;if(i.tracking){for(u=0;u<n.length;u++)o=n[u],e.removeEvent(t.element,o,i[o],!1);l(t),i.tracking=!1,delete r[t.hash]}}function a(e){return s[e.hash].insideElement}function f(t){var n=s[t.hash];n.capturing||(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.removeEvent(t.element,"mouseup",n.mouseup,!1),e.addEvent(t.element,"mouseup",n.mouseupie,!0),e.addEvent(t.element,"mousemove",n.mousemoveie,!0)):(e.addEvent(window,"mouseup",n.mouseupwindow,!0),e.addEvent(window,"mousemove",n.mousemove,!0)),n.capturing=!0)}function l(t){var n=s[t.hash];n.capturing&&(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.removeEvent(t.element,"mousemove",n.mousemoveie,!0),e.removeEvent(t.element,"mouseup",n.mouseupie,!0),e.addEvent(t.element,"mouseup",n.mouseup,!1)):(e.removeEvent(window,"mousemove",n.mousemove,!0),e.removeEvent(window,"mouseup",n.mouseupwindow,!0)),n.capturing=!1)}function c(e,t,n){var i;for(i in r)r.hasOwnProperty(i)&&e.hash!=i&&t(r[i],n)}function h(t,n){var r;t.focusHandler&&(r=t.focusHandler(t,n),r===!1&&e.cancelEvent(n))}function p(t,n){var r;t.blurHandler&&(r=t.blurHandler(t,n),r===!1&&e.cancelEvent(n))}function d(t,n){var r;t.keyHandler&&(r=t.keyHandler(t,n.keyCode?n.keyCode:n.charCode,n.shiftKey),r===!1&&e.cancelEvent(n))}function v(n,r){var r=e.getEvent(r),i=s[n.hash],o;e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&i.capturing&&!M(r.srcElement,n.element)&&c(n,v,r);var u=r.target?r.target:r.srcElement,a=r.relatedTarget?r.relatedTarget:r.fromElement;if(!M(n.element,u)||M(n.element,a))return;i.insideElement=!0,n.enterHandler&&(o=n.enterHandler(n,O(r,n.element),i.buttonDown,t),o===!1&&e.cancelEvent(r))}function m(n,r){var r=e.getEvent(r),i=s[n.hash],o;e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&i.capturing&&!M(r.srcElement,n.element)&&c(n,m,r);var u=r.target?r.target:r.srcElement,a=r.relatedTarget?r.relatedTarget:r.toElement;if(!M(n.element,u)||M(n.element,a))return;i.insideElement=!1,n.exitHandler&&(o=n.exitHandler(n,O(r,n.element),i.buttonDown,t),o===!1&&e.cancelEvent(r))}function g(t,r){var r=e.getEvent(r),o=s[t.hash],u;if(r.button==2)return;o.buttonDown=!0,o.lastPoint=A(r),o.lastMouseDownPoint=o.lastPoint,o.lastMouseDownTime=+(new Date),t.pressHandler&&(u=t.pressHandler(t,O(r,t.element)),u===!1&&e.cancelEvent(r)),(t.pressHandler||t.dragHandler)&&e.cancelEvent(r),e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&!!n?e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&i.push(t):(f(t),n=!0,i=[t])}function y(e,t){var n,r;t.touches.length==1&&t.targetTouches.length==1&&t.changedTouches.length==1&&(s[e.hash].lastTouch=t.touches[0],v(e,t.changedTouches[0]),g(e,t.touches[0])),t.touches.length==2&&(n=A(t.touches[0]),r=A(t.touches[1]),s[e.hash].lastPinchDelta=Math.abs(n.x-r.x)+Math.abs(n.y-r.y)),t.preventDefault()}function b(t,n){var n=e.getEvent(n),r=s[t.hash],i=r.buttonDown,o=r.insideElement,u;if(n.button==2)return;r.buttonDown=!1,t.releaseHandler&&(u=t.releaseHandler(t,O(n,t.element),i,o),u===!1&&e.cancelEvent(n)),i&&o&&N(t,n)}function w(e,t){t.touches.length==0&&t.targetTouches.length==0&&t.changedTouches.length==1&&(s[e.hash].lastTouch=null,b(e,t.changedTouches[0]),m(e,t.changedTouches[0])),t.touches.length+t.changedTouches.length==2&&(s[e.hash].lastPinchDelta=null),t.preventDefault()}function E(t,r){var r=e.getEvent(r),s,o;if(r.button==2)return;for(o=0;o<i.length;o++)s=i[o],a(s)||b(s,r);l(t),n=!1,r.srcElement.fireEvent("on"+r.type,document.createEventObject(r)),e.stopEvent(r)}function S(e,t){s[e.hash].insideElement||b(e,t),l(e)}function x(t,n){t.clickHandler&&e.cancelEvent(n)}function T(t,n){var r=0,i;n||(n=window.event),n.wheelDelta?(r=n.wheelDelta,window.opera&&(r=-r)):n.detail&&(r=-n.detail),r=r>0?1:-1,t.scrollHandler&&(i=t.scrollHandler(t,O(n,t.element),r,n.shiftKey),i===!1&&e.cancelEvent(n))}function N(t,n){var n=e.getEvent(n),r=s[t.hash],i;if(n.button==2)return;var o=+(new Date)-r.lastMouseDownTime,u=A(n),a=r.lastMouseDownPoint.distanceTo(u),f=o<=t.clickTimeThreshold&&a<=t.clickDistThreshold;t.clickHandler&&(i=t.clickHandler(t,O(n,t.element),f,n.shiftKey),i===!1&&e.cancelEvent(n))}function C(t,n){var n=e.getEvent(n),r=s[t.hash],i=A(n),o=i.minus(r.lastPoint),u;r.lastPoint=i,t.dragHandler&&(u=t.dragHandler(t,O(n,t.element),o,n.shiftKey),u===!1&&e.cancelEvent(n))}function k(e,t){var n,r,i;t.touches.length===1&&t.targetTouches.length===1&&t.changedTouches.length===1&&s[e.hash].lastTouch===t.touches[0]?C(e,t.touches[0]):t.touches.length===2&&(n=A(t.touches[0]),r=A(t.touches[1]),i=Math.abs(n.x-r.x)+Math.abs(n.y-r.y),Math.abs(s[e.hash].lastPinchDelta-i)>75&&(T(e,{shift:!1,pageX:(t.touches[0].pageX+t.touches[1].pageX)/2,pageY:(t.touches[0].pageY+t.touches[1].pageY)/2,detail:s[e.hash].lastPinchDelta>i?1:-1}),s[e.hash].lastPinchDelta=i
)),t.preventDefault()}function L(t,n){var r;for(r=0;r<i.length;r++)C(i[r],n);e.stopEvent(n)}function A(t){return e.getMousePosition(t)}function O(t,n){var r=e.getMousePosition(t),i=e.getElementPosition(n);return r.minus(i)}function M(e,t){var n=document.body;while(t&&e!=t&&n!=t)try{t=t.parentNode}catch(r){return!1}return e==t}function _(){t=!0}function D(){t=!1}var t=!1,n=!1,r={},i=[],s={};e.MouseTracker=function(t){var n=arguments;e.isPlainObject(t)||(t={element:n[0],clickTimeThreshold:n[1],clickDistThreshold:n[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.releaseHandler=t.releaseHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dragHandler=t.dragHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var r=this;s[this.hash]={mouseover:function(e){v(r,e)},mouseout:function(e){m(r,e)},mousedown:function(e){g(r,e)},mouseup:function(e){b(r,e)},click:function(e){x(r,e)},DOMMouseScroll:function(e){T(r,e)},mousewheel:function(e){T(r,e)},mouseupie:function(e){E(r,e)},mousemoveie:function(e){L(r,e)},mouseupwindow:function(e){S(r,e)},mousemove:function(e){C(r,e)},touchstart:function(e){y(r,e)},touchmove:function(e){k(r,e)},touchend:function(e){w(r,e)},keypress:function(e){d(r,e)},focus:function(e){h(r,e)},blur:function(e){p(r,e)},tracking:!1,capturing:!1,buttonDown:!1,insideElement:!1,lastPoint:null,lastMouseDownTime:null,lastMouseDownPoint:null,lastPinchDelta:0}},e.MouseTracker.prototype={isTracking:function(){return s[this.hash].tracking},setTracking:function(e){return e?o(this):u(this),this},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},releaseHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dragHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},function(){e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.addEvent(document,"mousedown",_,!1),e.addEvent(document,"mouseup",D,!1)):(e.addEvent(window,"mousedown",_,!0),e.addEvent(window,"mouseup",D,!0))}()}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Control=function(t,n,r){this.element=t,this.anchor=n,this.container=r,this.wrapper=e.makeNeutralElement("span"),this.wrapper.style.display="inline-block",this.wrapper.appendChild(this.element),this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%"),this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(e){this.wrapper.style.display=e?"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function n(e,t){var n=e.controls,r;for(r=n.length-1;r>=0;r--)if(n[r].element==t)return r;return-1}var t={};e.ControlDock=function(t){var n=["topleft","topright","bottomright","bottomleft"],r,i;e.extend(!0,this,{id:"controldock-"+ +(new Date)+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("form"),controls:[]},t),this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%");for(i=0;i<n.length;i++)r=n[i],this.controls[r]=e.makeNeutralElement("div"),this.controls[r].style.position="absolute",r.match("left")&&(this.controls[r].style.left="0px"),r.match("right")&&(this.controls[r].style.right="0px"),r.match("top")&&(this.controls[r].style.top="0px"),r.match("bottom")&&(this.controls[r].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(t,r){var t=e.getElement(t),i=null;if(n(this,t)>=0)return;switch(r){case e.ControlAnchor.TOP_RIGHT:i=this.controls.topright,t.style.position="relative",t.style.marginRight="4px",t.style.marginTop="4px";break;case e.ControlAnchor.BOTTOM_RIGHT:i=this.controls.bottomright,t.style.position="relative",t.style.marginRight="4px",t.style.marginBottom="4px";break;case e.ControlAnchor.BOTTOM_LEFT:i=this.controls.bottomleft,t.style.position="relative",t.style.marginLeft="4px",t.style.marginBottom="4px";break;case e.ControlAnchor.TOP_LEFT:i=this.controls.topleft,t.style.position="relative",t.style.marginLeft="4px",t.style.marginTop="4px";break;case e.ControlAnchor.NONE:default:i=this.container,t.style.margin="0px",t.style.padding="0px"}this.controls.push(new e.Control(t,r,i)),t.style.display="inline-block"},removeControl:function(t){var t=e.getElement(t),r=n(this,t);return r>=0&&(this.controls[r].destroy(),this.controls.splice(r,1)),this},clearControls:function(){while(this.controls.length>0)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){function r(e,n,r){var i,s,o;return t[e.hash].animating?window.setTimeout(function(){n(e)},1):(i=+(new Date),r=r?r:i,s=r+1e3/60,o=Math.max(1,s-i),window.setTimeout(function(){n(e)},o))}function s(e){window.setTimeout(function(){u(e)},20)}function o(e){if(!e.autoHideControls)return;e.controlsShouldFade=!0,e.controlsFadeBeginTime=+(new Date)+e.controlsFadeDelay,window.setTimeout(function(){s(e)},e.controlsFadeDelay)}function u(e){var t,n,r,i;if(e.controlsShouldFade){t=(new Date).getTime(),n=t-e.controlsFadeBeginTime,r=1-n/e.controlsFadeLength,r=Math.min(1,r),r=Math.max(0,r);for(i=e.controls.length-1;i>=0;i--)e.controls[i].setOpacity(r);r>0&&s(e)}}function a(e){var t;e.controlsShouldFade=!1;for(t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function f(){a(this)}function l(){o(this)}function c(e,t,n,r){var i,s;this.viewport&&n&&(zoomPerClick=this.zoomPerClick,s=r?1/zoomPerClick:zoomPerClick,this.viewport.zoomBy(s,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints())}function h(e,t,n,r){this.viewport&&(this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(n.negate())))}function p(e,t,n,r){n&&this.viewport&&this.viewport.applyConstraints()}function d(e,t,n,r){var i;return this.viewport&&(i=Math.pow(this.zoomPerScroll,n),this.viewport.zoomBy(i,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints()),!1}function v(e,n,r,i){r||(t[this.hash].mouseInside=!1,t[this.hash].animating||o(this))}function m(e,n,r,i){i||(t[this.hash].mouseInside=!1,t[this.hash].animating||o(this))}function g(e,n,r,i){t[this.hash].mouseInside=!0,a(this)}function y(e){var t;if(!e.source)return;t=+(new Date),b(e),r(e,arguments.callee,t)}function b(n){var r,i;if(!n.source)return;r=e.getElementSize(n.container),r.equals(t[n.hash].prevContainerSize)||(n.viewport.resize(r,!0),t[n.hash].prevContainerSize=r,n.raiseEvent("resize")),i=n.viewport.update(),!t[n.hash].animating&&i&&(n.raiseEvent("animationstart"),a(n));if(i)n.drawer.update(),n.navigator&&n.navigator.update(n.viewport),n.raiseEvent("animation");else if(t[n.hash].forceRedraw||n.drawer.needsUpdate())n.drawer.update(),n.navigator&&n.navigator.update(n.viewport),t[n.hash].forceRedraw=!1;t[n.hash].animating&&!i&&(n.raiseEvent("animationfinish"),t[n.hash].mouseInside||o(n)),t[n.hash].animating=i}function w(e,t){return e?e+t:t}function E(){t[this.hash].lastZoomTime=+(new Date),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,T(this)}function S(){t[this.hash].lastZoomTime=+(new Date),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,T(this)}function x(){t[this.hash].zooming=!1}function T(t){window.setTimeout(e.delegate(t,N),10)}function N(){var e,n,r;t[this.hash].zooming&&this.viewport&&(e=+(new Date),n=e-t[this.hash].lastZoomTime,adjustedFactor=Math.pow(t[this.hash].zoomFactor,n/1e3),this.viewport.zoomBy(adjustedFactor),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=e,T(this))}function C(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function k(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function L(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function A(){this.viewport&&this.viewport.goHome()}function O(){this.setFullPage(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function M(){var e=t[this.hash].sequence-1;this.goToPage(e)}function _(){var e=t[this.hash].sequence+1;this.goToPage(e)}var t={},n={};e.Viewer=function(n){var r=arguments,i=this,s;e.isPlainObject(n)||(n={id:r[0],xmlPath:r.length>1?r[1]:undefined,prefixUrl:r.length>2?r[2]:undefined,controls:r.length>3?r[3]:undefined,overlays:r.length>4?r[4]:undefined,overlayControls:r.length>5?r[5]:undefined}),n.config&&(e.extend(!0,n,n.config),delete n.config),e.extend(!0,this,{id:n.id,hash:n.id,element:null,canvas:null,container:null,overlays:[],overlayControls:[],previousBody:[],customControls:[],source:null,drawer:null,viewport:null,navigator:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,n),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,lastOpenStartTime:0,lastOpenEndTime:0,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,sequenced:!1,sequence:0},e.EventHandler.call(this),e.ControlDock.call(this,n);var u,a;this.xmlPath&&(this.tileSources=[this.xmlPath]),this.tileSources&&(e.isArray(this.tileSources)?(this.tileSources.length>1&&(t[this.hash].sequenced=!0),u=this.tileSources[0]):u=this.tileSources,this.openTileSource(u)),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),function(e){e.width="100%",e.height="100%",e.position="relative",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=(new e.MouseTracker({element:this.canvas,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:e.delegate(this,c),dragHandler:e.delegate(this,h),releaseHandler:e.delegate(this,p),scrollHandler:e.delegate(this,d)})).setTracking(this.mouseNavEnabled?!0:!1),this.outerTracker=(new e.MouseTracker({element:this.container,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:e.delegate(this,g),exitHandler:e.delegate(this,v),releaseHandler:e.delegate(this,m)})).setTracking(this.mouseNavEnabled?!0:!1),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),this.bindSequenceControls();for(s=0;s<this.customControls.length;s++)this.addControl(this.customControls[s].id,this.customControls[s].anchor);window.setTimeout(function(){o(i)},1)},e.extend(e.Viewer.prototype,e.EventHandler.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.source},openDzi:function(t){var n=this;return e.createFromDZI(t,function(e){n.open(e)},this.tileHost),this},openTileSource:function(t){var n=this,r,i,s,o;return setTimeout(function(){e.type(t)=="string"?t=new e.TileSource(t,function(e){n.open(e)}):e.isPlainObject(t)?e.isFunction(t.getTileUrl)?(r=new e.TileSource(t.width,t.height,t.tileSize,t.tileOverlap,t.minLevel,t.maxLevel),r.getTileUrl=t.getTileUrl,n.open(r)):(s=e.TileSource.determineType(n,t),o=s.prototype.configure.apply(n,[t]),i=new s(o),n.open(i)):n.open(t)},1),this},open:function(i){var s=this,o,u;this.source&&this.close(),t[this.hash].lastOpenStartTime=+(new Date),window.setTimeout(function(){t[s.hash].lastOpenStartTime>t[s.hash].lastOpenEndTime&&t[s.hash].setMessage(e.getString("Messages.Loading"))},2e3),t[this.hash].lastOpenEndTime=+(new Date),this.canvas.innerHTML="",t[this.hash].prevContainerSize=e.getElementSize(this.container),i&&(this.source=i),this.viewport=this.viewport?this.viewport:new e.Viewport({containerSize:t[this.hash].prevContainerSize,contentSize:this.source.dimensions,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical}),this.preserveVewport?this.viewport.resetContentSize(this.source.dimensions):this.defaultZoomLevel&&this.viewport.zoomTo(this.defaultZoomLevel,this.viewport.getCenter(),!0),this.drawer=new e.Drawer({source:this.source,viewport:this.viewport,element:this.canvas,overlays:this.overlays,maxImageCacheCount:this.maxImageCacheCount,imageLoaderLimit:this.imageLoaderLimit,minZoomImageRatio:this.minZoomImageRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,immediateRender:this.immediateRender,blendTime:this.blendTime,alwaysBlend:this.alwaysBlend,minPixelRatio:this.minPixelRatio}),this.showNavigator&&!this.navigator&&(this.navigator=new e.Navigator({id:this.navigatorElement,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,height:this.navigatorHeight,width:this.navigatorWidth,tileSources:this.tileSources,tileHost:this.tileHost,prefixUrl:this.prefixUrl,overlays:this.overlays,viewer:this})),t[this.hash].animating=!1,t[this.hash].forceRedraw=!0,r(this,y);for(u=0;u<this.overlayControls.length;u++)o=this.overlayControls[u],o.point!=null?this.drawer.addOverlay(o.id,new e.Point(o.point.X,o.point.Y),e.OverlayPlacement.TOP_LEFT):this.drawer.addOverlay(o.id,new e.Rect(o.rect.Point.X,o.rect.Point.Y,o.rect.Width,o.rect.Height),o.placement);return n[this.hash]=this,this.raiseEvent("open"),this.navigator&&this.navigator.open(i),this},close:function(){return this.source=null,this.drawer=null,this.viewport=this.preserveViewport?this.viewport:null,this.canvas.innerHTML="",n[this.hash]=null,delete n[this.hash],this},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this},areControlsEnabled:function(){return this.controls.length&&this.controls[i].isVisibile()},setControlsEnabled:function(e){e?a(this):o(this)},isFullPage:function(){return this.container.parentNode==document.body},setFullPage:function(r){var i=document.body,s=i.style,o=document.documentElement.style,u=this.container.style,a=this.canvas.style,f,l,c,h,p,d;if(r==this.isFullPage())return;if(r){this.bodyOverflow=s.overflow,this.docOverflow=o.overflow,s.overflow="hidden",o.overflow="hidden",this.bodyWidth=s.width,this.bodyHeight=s.height,s.width="100%",s.height="100%",a.backgroundColor="black",a.color="white",u.position="fixed",this.previousBody=[],p=i.childNodes.length;for(d=0;d<p;d++)this.previousBody.push(i.childNodes[0]),i.removeChild(i.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,i.appendChild(this.toolbar.element),this.toolbar.element.setAttribute("class",this.toolbar.element.className+" fullpage"),this.toolbar.element.style.position="fixed",this.container.style.top=e.getElementSize(this.toolbar.element).y+"px"),i.appendChild(this.container),t[this.hash].prevContainerSize=e.getWindowSize(),e.delegate(this,g)()}else{s.overflow=this.bodyOverflow,o.overflow=this.docOverflow,s.width=this.bodyWidth,s.height=this.bodyHeight,a.backgroundColor="",a.color="",u.position="relative",u.zIndex="",this.toolbar&&this.toolbar.element&&(i.removeChild(this.toolbar.element),this.toolbar.element.setAttribute("class",this.toolbar.element.className.replace("fullpage","")),this.toolbar.element.style.position="relative",this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling,this.container.style.top="auto"),i.removeChild(this.container),p=this.previousBody.length;for(d=0;d<p;d++)i.appendChild(this.previousBody.shift());this.element.appendChild(this.container),t[this.hash].prevContainerSize=e.getElementSize(this.element),e.delegate(this,v)()}if(this.viewport){f=this.viewport.getBounds(),this.viewport.resize(t[this.hash].prevContainerSize),l=this.viewport.getBounds();if(r)t[this.hash].fsBoundsDelta=new e.Point(l.width/f.width,l.height/f.height);else{this.viewport.update(),this.viewport.zoomBy(Math.max(t[this.hash].fsBoundsDelta.x,t[this.hash].fsBoundsDelta.y),null,!0);for(h in n)c=n[h],c!==this&&c!=this.navigator&&(c.open(c.source),c.navigator&&c.navigator.open(c.source))}t[this.hash].forceRedraw=!0,this.raiseEvent("resize",this),b(this)}return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this},bindSequenceControls:function(){var n=e.delegate(this,f),r=e.delegate(this,l),i=e.delegate(this,_),s=e.delegate(this,M),o=this.navImages,u=[],a=!0;if(this.showSequenceControl&&t[this.hash].sequenced){if(this.previousButton||this.nextButton)a=!1;this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:w(this.prefixUrl,o.previous.REST),srcGroup:w(this.prefixUrl,o.previous.GROUP),srcHover:w(this.prefixUrl,o.previous.HOVER),srcDown:w(this.prefixUrl,o.previous.DOWN),onRelease:s,onFocus:n,onBlur:r}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:w(this.prefixUrl,o.next.REST),srcGroup:w(this.prefixUrl,o.next.GROUP),srcHover:w(this.prefixUrl,o.next.HOVER),srcDown:w(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:n,onBlur:r}),this.previousButton.disable(),a&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.navControl,e.ControlAnchor.BOTTOM_RIGHT):this.addControl(this.pagingControl,e.ControlAnchor.TOP_LEFT))}},bindStandardControls:function(){var t=e.delegate(this,E),n=e.delegate(this,x),r=e.delegate(this,C),i=e.delegate(this,S),s=e.delegate(this,k),o=e.delegate(this,A),u=e.delegate(this,O),a=e.delegate(this,f),c=e.delegate(this,l),h=this.navImages,p=[],d=!0;if(this.showNavigationControl){if(this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton)d=!1;p.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:w(this.prefixUrl,h.zoomIn.REST),srcGroup:w(this.prefixUrl,h.zoomIn.GROUP),srcHover:w(this.prefixUrl,h.zoomIn.HOVER),srcDown:w(this.prefixUrl,h.zoomIn.DOWN),onPress:t,onRelease:n,onClick:r,onEnter:t,onExit:n,onFocus:a,onBlur:c})),p.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:w(this.prefixUrl,h.zoomOut.REST),srcGroup:w(this.prefixUrl,h.zoomOut.GROUP),srcHover:w(this.prefixUrl,h.zoomOut.HOVER),srcDown:w(this.prefixUrl,h.zoomOut.DOWN),onPress:i,onRelease:n,onClick:s,onEnter:i,onExit:n,onFocus:a,onBlur:c})),p.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:w(this.prefixUrl,h.home.REST),srcGroup:w(this.prefixUrl,h.home.GROUP),srcHover:w(this.prefixUrl,h.home.HOVER),srcDown:w(this.prefixUrl,h.home.DOWN),onRelease:o,onFocus:a,onBlur:c})),p.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:w(this.prefixUrl,h.fullpage.REST),srcGroup:w(this.prefixUrl,h.fullpage.GROUP),srcHover:w(this.prefixUrl,h.fullpage.HOVER),srcDown:w(this.prefixUrl,h.fullpage.DOWN),onRelease:u,onFocus:a,onBlur:c})),d&&(this.buttons=new e.ButtonGroup({buttons:p,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,L)),this.toolbar?this.toolbar.addControl(this.navControl,e.ControlAnchor.TOP_LEFT):this.addControl(this.navControl,e.ControlAnchor.BOTTOM_RIGHT))}},goToPage:function(n){this.tileSources.length>n&&(t[this.hash].sequence=n,this.nextButton&&(this.tileSources.length-1===n?this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(n>0?this.previousButton.enable():this.previousButton.disable()),this.openTileSource(this.tileSources[n])),e.isFunction(this.onPageChange)&&this.onPageChange({page:n,viewer:this})}})}(OpenSeadragon),function(e){function t(e,t,n,r){this.displayRegion.focus()}function n(e,t,n,r){this.viewer.viewport&&(this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(n)))}function r(e,t,n,r){n&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function i(e,t,n,r){var i;return this.viewer.viewport&&(i=Math.pow(this.zoomPerScroll,n),this.viewer.viewport.zoomBy(i,this.viewport.getCenter()),this.viewer.viewport.applyConstraints()),!1}e.Navigator=function(s){var o=this,u=s.viewer,a=e.getElementSize(u.element);s.id||(s.id="navigator-"+ +(new Date),this.element=e.makeNeutralElement("div"),this.element.id=s.id,this.element.className="navigator"),s=e.extend(!0,{navigatorSizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),s.minPixelRatio=Math.min(s.navigatorSizeRatio*e.DEFAULT_SETTINGS.minPixelRatio,e.DEFAULT_SETTINGS.minPixelRatio),function(e){e.marginTop="0px",e.marginRight="0px",e.marginBottom="0px",e.marginLeft="0px",e.border="2px solid #555",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style),this.displayRegion=e.makeNeutralElement("textarea"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.border="2px solid #900";try{e.outline="2px auto #900"}catch(t){}e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style),this.element.innerTracker=(new e.MouseTracker({element:this.element,scrollHandler:function(){return!1}})).setTracking(!0),this.displayRegion.innerTracker=(new e.MouseTracker({element:this.displayRegion,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:e.delegate(this,t),dragHandler:e.delegate(this,n),releaseHandler:e.delegate(this,r),scrollHandler:e.delegate(this,i),focusHandler:function(){var t=e.getElementPosition(o.viewer.element);window.scrollTo(0,t.y),o.viewer.setControlsEnabled(!0),function(e){e.border="2px solid #437AB2",e.outline="2px auto #437AB2"}(this.element.style)},blurHandler:function(){o.viewer.setControlsEnabled(!1),function(e){e.border="2px solid #900",e.outline="2px auto #900"}(this.element.style)},keyHandler:function(t,n,r){switch(n){case 61:return o.viewer.viewport.zoomBy(1.1),o.viewer.viewport.applyConstraints(),!1;case 45:return o.viewer.viewport.zoomBy(.9),o.viewer.viewport.applyConstraints(),!1;case 48:return o.viewer.viewport.goHome(),o.viewer.viewport.applyConstraints(),!1;case 119:case 87:case 38:return r?o.viewer.viewport.zoomBy(1.1):o.viewer.viewport.panBy(new e.Point(0,-0.05)),o.viewer.viewport.applyConstraints(),!1;case 115:case 83:case 40:return r?o.viewer.viewport.zoomBy(.9):o.viewer.viewport.panBy(new e.Point(0,.05)),o.viewer.viewport.applyConstraints(),!1;case 97:case 37:return o.viewer.viewport.panBy(new e.Point(-0.05,0)),o.viewer.viewport.applyConstraints(),!1;case 100:case 39:return o.viewer.viewport.panBy(new e.Point(.05,0)),o.viewer.viewport.applyConstraints(),!1;default:return!0}}})).setTracking(!0),this.element.appendChild(this.displayRegion),u.addControl(this.element,e.ControlAnchor.TOP_RIGHT),s.width&&s.height?(this.element.style.width=s.width+"px",this.element.style.height=s.height+"px"):(this.element.style.width=a.x*s.navigatorSizeRatio+"px",this.element.style.height=a.y*s.navigatorSizeRatio+"px"),e.Viewer.apply(this,[s])},e.extend(e.Navigator.prototype,e.EventHandler.prototype,e.Viewer.prototype,{update:function(e){var t,n,r;e&&this.viewport&&(t=e.getBounds(!0),n=this.viewport.pixelFromPoint(t.getTopLeft()),r=this.viewport.pixelFromPoint(t.getBottomRight()),function(e){e.top=n.y+"px",e.left=n.x+"px",e.width=Math.abs(n.x-r.x)-3+"px",e.height=Math.abs(n.y-r.y)-3+"px"}(this.displayRegion.style))}})}(OpenSeadragon),function(e){var t={Errors:{Failure:"Sorry, but Seadragon Ajax can't run on your browser!\nPlease try using IE 7 or Firefox 3.\n",Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Empty:"You asked us to open nothing, so we did just that.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",Unknown:"Whoops, something inexplicably went wrong. Sorry!"},Messages:{Loading:"Loading..."},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page"}};e.extend(e,{getString:function(e){var n=e.split("."),r=null,i=arguments,s;for(s=0;s<n.length;s++)r=t[n[s]]||{};return typeof r!="string"&&(r=""),r.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/))+1;return t<i.length?i[t]:""})},setString:function(t,n){var r=t.split("."),i=e.Strings,s;for(s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[s]]=n}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0},e.Point.prototype={plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},toString:function(){return"("+this.x+","+this.y+")"}}}(OpenSeadragon),function($){function processResponse(xhr){var responseText=xhr.responseText,status=xhr.status,statusText,data;if(!xhr)throw new Error($.getString("Errors.Security"));if(xhr.status!==200&&xhr.status!==0)throw status=xhr.status,statusText=status==404?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else responseText.match(/\s*[\{\[].*/)?data=eval(responseText):data=responseText;return data}$.TileSource=function(e,t,n,r,i,s){var o=this,u=null,a=null,f=arguments,l,c;$.isPlainObject(e)?l=e:l={width:f[0],height:f[1],tileSize:f[2],tileOverlap:f[3],minlevel:f[4],maxLevel:f[5]},$.EventHandler.call(this),$.extend(!0,this,l);for(c=0;c<arguments.length;c++)if($.isFunction(arguments[c])){u=arguments[c],this.addHandler("ready",function(e,t){u(t)});break}"string"==$.type(arguments[0])?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this.tileSize=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(arguments[0])):(this.ready=!0,this.aspectRatio=l.width&&l.height?l.width/l.height:1,this.dimensions=new $.Point(l.width,l.height),this.tileSize=l.tileSize?l.tileSize:0,this.tileOverlap=l.tileOverlap?l.tileOverlap:0,this.minLevel=l.minLevel?l.minLevel:0,this.maxLevel=l.maxLevel?l.maxLevel:l.width&&l.height?Math.ceil(Math.log(Math.max(l.width,l.height))/Math.log(2)):0,u&&$.isFunction(u)&&u(this))},$.TileSource.prototype={getLevelScale:function(e){return 1/(1<<this.maxLevel-e)},getNumTiles:function(e){var t=this.getLevelScale(e),n=Math.ceil(t*this.dimensions.x/this.tileSize),r=Math.ceil(t*this.dimensions.y/this.tileSize);return new $.Point(n,r)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),n=1/t.x,r=1/t.y;return new $.Point(n,r)},getTileAtPoint:function(e,t){var n=t.times(this.dimensions.x).times(this.getLevelScale(e)),r=Math.floor(n.x/this.tileSize),i=Math.floor(n.y/this.tileSize);return new $.Point(r,i)},getTileBounds:function(e,t,n){var r=this.dimensions.times(this.getLevelScale(e)),i=t===0?0:this.tileSize*t-this.tileOverlap,s=n===0?0:this.tileSize*n-this.tileOverlap,o=this.tileSize+(t===0?1:2)*this.tileOverlap,u=this.tileSize+(n===0?1:2)*this.tileOverlap,a=1/r.x;return o=Math.min(o,r.x-i),u=Math.min(u,r.y-s),new $.Rect(i*a,s*a,o*a,u*a)},getImageInfo:function(e){var t=this,e=e,n,r,i,s,o,u,a,f,l;e&&(u=e.split("/"),a=u[u.length-1],f=a.lastIndexOf("."),f>-1&&(u[u.length-1]=a.slice(0,f))),i=function(n){var r=$.TileSource.determineType(t,n,e);o=r.prototype.configure.apply(t,[n,e]),s=new r(o),t.ready=!0,t.raiseEvent("ready",s)},e.match(/\.js$/)?(r=e.split("/").pop().replace(".js",""),$.jsonp({url:e,async:!1,callbackName:r,callback:i})):$.makeAjaxRequest(e,function(e){var t=processResponse(e);i(t)})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,n){throw new Error("Method not implemented.")},tileExists:function(e,t,n){var r=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<r.x&&n<r.y}},$.extend(!0,$.TileSource.prototype,$.EventHandler.prototype),$.TileSource.determineType=function(e,t,n){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[r])&&$.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(e,t,n))return OpenSeadragon[r]}}(OpenSeadragon),function(e){function t(t,r){if(!r||!r.documentElement)throw new Error(e.getString("Errors.Xml"));var i=r.documentElement,s=i.tagName,o=null,u=[],a,f,l,c,h;if(s=="Image")try{c=i.getElementsByTagName("Size")[0],o={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Format:i.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(i.getAttribute("Overlap")),TileSize:parseInt(i.getAttribute("TileSize")),Size:{Height:parseInt(c.getAttribute("Height")),Width:parseInt(c.getAttribute("Width"))}}};if(!e.imageFormatSupported(o.Image.Format))throw new Error(e.getString("Errors.ImageFormat",o.Image.Format.toUpperCase()));a=i.getElementsByTagName("DisplayRect");for(h=0;h<a.length;h++)f=a[h],l=f.getElementsByTagName("Rect")[0],u.push({Rect:{X:parseInt(l.getAttribute("X")),Y:parseInt(l.getAttribute("Y")),Width:parseInt(l.getAttribute("Width")),Height:parseInt(l.getAttribute("Height")),MinLevel:0,MaxLevel:parseInt(f.getAttribute("MaxLevel"))}});return u.length&&(o.Image.DisplayRect=u),n(t,o)}catch(p){throw p instanceof Error?p:new Error(e.getString
("Errors.Dzi"))}else{if(s=="Collection")throw new Error(e.getString("Errors.Dzc"));if(s=="Error")return processDZIError(i)}throw new Error(e.getString("Errors.Dzi"))}function n(t,n){var r=n.Image,i=r.Url,s=r.Format,o=r.Size,u=r.DisplayRect||[],a=parseInt(o.Width),f=parseInt(o.Height),l=parseInt(r.TileSize),c=parseInt(r.Overlap),h=[],p,d;for(d=0;d<u.length;d++)p=u[d].Rect,h.push(new e.DisplayRect(parseInt(p.X),parseInt(p.Y),parseInt(p.Width),parseInt(p.Height),0,parseInt(p.MaxLevel)));return{width:a,height:f,tileSize:l,tileOverlap:c,minLevel:null,maxLevel:null,tilesUrl:i,fileFormat:s,dispRects:h}}e.DziTileSource=function(t,n,r,i,s,o,u){var a,f,l,c;e.isPlainObject(t)?c=t:c={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],dispRects:arguments[6]},this._levelRects={},this.tilesUrl=c.tilesUrl,this.fileFormat=c.fileFormat,this.displayRects=c.displayRects;if(this.displayRects)for(a=this.displayRects.length-1;a>=0;a--){f=this.displayRects[a];for(l=f.minLevel;l<=f.maxLevel;l++)this._levelRects[l]||(this._levelRects[l]=[]),this._levelRects[l].push(f)}e.TileSource.apply(this,[c])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.Image&&"http://schemas.microsoft.com/deepzoom/2008"==e.Image.xmlns||e.documentElement&&"Image"==e.documentElement.tagName&&"http://schemas.microsoft.com/deepzoom/2008"==e.documentElement.namespaceURI},configure:function(r,i){var s,o,u,a,f;return r instanceof XMLDocument?a=t(this,r):"object"==e.type(r)&&(a=n(this,r)),i&&!a.tilesUrl&&("http"!=i.substring(0,4)&&(f=location.protocol+"//"+location.host),s=i.split("/"),o=s.pop(),o=o.match(/^(.+)\.dzi$/i)[1],s="/"+s.join("/")+"/"+o+"_files/",u=s,f&&(u=f+u),a.tilesUrl=u),a},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat].join("")},tileExists:function(e,t,n){var r=this._levelRects[e],i,s,o,u,a,f,l;if(!r||!r.length)return!0;for(l=r.length-1;l>=0;l--){i=r[l];if(e<i.minLevel||e>i.maxLevel)continue;s=this.getLevelScale(e),o=i.x*s,u=i.y*s,a=o+i.width*s,f=u+i.height*s,o=Math.floor(o/this.tileSize),u=Math.floor(u/this.tileSize),a=Math.ceil(a/this.tileSize),f=Math.ceil(f/this.tileSize);if(o<=t&&t<a&&u<=n&&n<f)return!0}return!1}})}(OpenSeadragon),function(e){function t(e){var t=[],n,r;for(r=0;r<e.length;r++)n=e[r],n.height&&n.width&&n.url&&(n.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||n.mimetype&&n.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))&&t.push({url:n.url,width:Number(n.width),height:Number(n.height)});return t.sort(function(e,t){return e.height-t.height})}function n(t,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var i=n.documentElement,s=i.tagName,o=null,u=[],a,f;if(s=="image")try{o={type:i.getAttribute("type"),levels:[]},u=i.getElementsByTagName("level");for(f=0;f<u.length;f++)a=u[f],o.levels.push({url:a.getAttribute("url"),width:parseInt(a.getAttribute("width")),height:parseInt(a.getAttribute("height"))});return r(t,o)}catch(l){throw l instanceof Error?l:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(s=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(s=="error")throw new Error("Error: "+n)}throw new Error("Unknown element "+s)}function r(e,t){return t.levels}e.LegacyTileSource=function(n){var r,i,s;e.isArray(n)&&(r={type:"legacy-image-pyramid",levels:n}),r.levels=t(r.levels),i=r.levels[r.levels.length-1].width,s=r.levels[r.levels.length-1].height,e.extend(!0,r,{width:i,height:s,tileSize:Math.max(s,i),tileOverlap:0,minLevel:0,maxLevel:r.levels.length-1}),e.TileSource.apply(this,[r]),this.levels=r.levels},e.LegacyTileSource.prototype={supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(t,i){var s;return t instanceof XMLDocument?s=n(this,t):"object"==e.type(t)&&(s=r(this,t)),s},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getPixelRatio:function(t){var n=this.dimensions.times(this.getLevelScale(t)),r=1/n.x,i=1/n.y;return new e.Point(r,i)},getTileAtPoint:function(t,n){return new e.Point(0,0)},getTileBounds:function(t,n,r){var i=this.dimensions.times(this.getLevelScale(t)),s=n===0?0:this.levels[t].width,o=r===0?0:this.levels[t].height,u=this.levels[t].width,a=this.levels[t].height,f=1/(this.width>=this.height?i.y:i.x);return u=Math.min(u,i.x-s),a=Math.min(a,i.y-o),new e.Rect(s*f,o*f,u*f,a*f)},getTileUrl:function(e,t,n){var r=null;return e>=this.minLevel&&e<=this.maxLevel&&(r=this.levels[e].url),r},tileExists:function(e,t,n){var r=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<r.x&&n<r.y}}}(OpenSeadragon),function(e){function t(e){window.setTimeout(function(){n(e)},20)}function n(n){var r,i,s;n.shouldFade&&(r=+(new Date),i=r-n.fadeBeginTime,s=1-i/n.fadeLength,s=Math.min(1,s),s=Math.max(0,s),n.imgGroup&&e.setElementOpacity(n.imgGroup,s,!0),s>0&&t(n))}function r(e){e.shouldFade=!0,e.fadeBeginTime=+(new Date)+e.fadeDelay,window.setTimeout(function(){t(e)},e.fadeDelay)}function i(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function s(t,n){if(t.element.disabled)return;n>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(i(t),t.currentState=e.ButtonState.GROUP),n>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),n>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN)}function o(t,n){if(t.element.disabled)return;n<=e.ButtonState.HOVER&&t.currentState==e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&t.currentState==e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&t.currentState==e.ButtonState.GROUP&&(r(t),t.currentState=e.ButtonState.REST)}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var n=this;e.EventHandler.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("button"),this.element.href=this.element.href||"#",t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="")),this.addHandler("onPress",this.onPress),this.addHandler("onRelease",this.onRelease),this.addHandler("onClick",this.onClick),this.addHandler("onEnter",this.onEnter),this.addHandler("onExit",this.onExit),this.addHandler("onFocus",this.onFocus),this.addHandler("onBlur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=(new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t,r,i,o){i?(s(n,e.ButtonState.DOWN),n.raiseEvent("onEnter",n)):o||s(n,e.ButtonState.HOVER)},focusHandler:function(e,t,r,i){this.enterHandler(e,t,r,i),n.raiseEvent("onFocus",n)},exitHandler:function(t,r,i,s){o(n,e.ButtonState.GROUP),i&&n.raiseEvent("onExit",n)},blurHandler:function(e,t,r,i){this.exitHandler(e,t,r,i),n.raiseEvent("onBlur",n)},pressHandler:function(t,r){s(n,e.ButtonState.DOWN),n.raiseEvent("onPress",n)},releaseHandler:function(t,r,i,u){i&&u?(o(n,e.ButtonState.HOVER),n.raiseEvent("onRelease",n)):i?o(n,e.ButtonState.GROUP):s(n,e.ButtonState.HOVER)},clickHandler:function(e,t,r,i){r&&n.raiseEvent("onClick",n)},keyHandler:function(e,t){return 13===t?(n.raiseEvent("onClick",n),n.raiseEvent("onRelease",n),!1):!0}})).setTracking(!0),o(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventHandler.prototype,{notifyGroupEnter:function(){s(this,e.ButtonState.GROUP)},notifyGroupExit:function(){o(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var n=this.buttons.concat([]),r=this,i;this.element=t.element||e.makeNeutralElement("fieldgroup");if(!t.group){this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label);for(i=0;i<n.length;i++)this.element.appendChild(n[i].element)}this.tracker=(new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupEnter()},exitHandler:function(){var e,t=arguments.length>2?arguments[2]:null;if(!t)for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupExit()},releaseHandler:function(){var e,t=arguments.length>3?arguments[3]:null;if(!t)for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupExit()}})).setTracking(!0)},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler()},emulateExit:function(){this.tracker.exitHandler()}}}(OpenSeadragon),function(e){e.Rect=function(e,t,n,r){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0,this.width=typeof n=="number"?n:0,this.height=typeof r=="number"?r:0},e.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height)},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},toString:function(){return"["+this.x+","+this.y+","+this.width+"x"+this.height+"]"}}}(OpenSeadragon),function(e){e.DisplayRect=function(t,n,r,i,s,o){e.Rect.apply(this,[t,n,r,i]),this.minLevel=s,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}e.Spring=function(t){var n=arguments;typeof t!="object"&&(t={initial:n.length&&typeof n[0]=="number"?n[0]:0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.extend(!0,this,t),this.current={value:typeof this.initial=="number"?this.initial:0,time:(new Date).getTime()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time}},e.Spring.prototype={resetTo:function(e){this.target.value=e,this.target.time=this.current.time,this.start.value=this.target.value,this.start.time=this.target.time},springTo:function(e){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime},shiftBy:function(e){this.start.value+=e,this.target.value+=e},update:function(){this.current.time=(new Date).getTime(),this.current.value=this.current.time>=this.target.time?this.target.value:this.start.value+(this.target.value-this.start.value)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time))}}}(OpenSeadragon),function(e){e.Tile=function(e,t,n,r,i,s){this.level=e,this.x=t,this.y=n,this.bounds=r,this.exists=i,this.url=s,this.loaded=!1,this.loading=!1,this.element=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(t){var n=this.position.apply(Math.floor),r=this.size.apply(Math.ceil);if(!this.loaded||!this.image){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("img"),this.element.src=this.url,this.style=this.element.style,this.style.position="absolute",this.style.msInterpolationMode="nearest-neighbor"),this.element.parentNode!=t&&t.appendChild(this.element),this.element.style.left=n.x+"px",this.element.style.top=n.y+"px",this.element.style.width=r.x+"px",this.element.style.height=r.y+"px",e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(t){var n=this.position,r=this.size;if(!this.loaded||!this.image){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}t.globalAlpha=this.opacity,t.drawImage(this.image,n.x,n.y,r.x,r.y)},unload:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.image=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},e.Overlay=function(t,n,r){this.element=t,this.scales=n instanceof e.Rect,this.bounds=new e.Rect(n.x,n.y,n.width,n.height),this.position=new e.Point(n.x,n.y),this.size=new e.Point(n.width,n.height),this.style=t.style,this.placement=n instanceof e.Point?r:e.OverlayPlacement.TOP_LEFT},e.Overlay.prototype={adjust:function(t,n){switch(this.placement){case e.OverlayPlacement.TOP_LEFT:break;case e.OverlayPlacement.TOP:t.x-=n.x/2;break;case e.OverlayPlacement.TOP_RIGHT:t.x-=n.x;break;case e.OverlayPlacement.RIGHT:t.x-=n.x,t.y-=n.y/2;break;case e.OverlayPlacement.BOTTOM_RIGHT:t.x-=n.x,t.y-=n.y;break;case e.OverlayPlacement.BOTTOM:t.x-=n.x/2,t.y-=n.y;break;case e.OverlayPlacement.BOTTOM_LEFT:t.y-=n.y;break;case e.OverlayPlacement.LEFT:t.y-=n.y/2;break;case e.OverlayPlacement.CENTER:default:t.x-=n.x/2,t.y-=n.y/2}},destroy:function(){var e=this.element,t=this.style;e.parentNode&&e.parentNode.removeChild(e),t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},drawHTML:function(t){var n=this.element,r=this.style,i=this.scales,s,o;n.parentNode!=t&&t.appendChild(n),i||(this.size=e.getElementSize(n)),s=this.position,o=this.size,this.adjust(s,o),s=s.apply(Math.floor),o=o.apply(Math.ceil),r.left=s.x+"px",r.top=s.y+"px",r.position="absolute",i&&(r.width=o.x+"px",r.height=o.y+"px")},update:function(t,n){this.scales=t instanceof e.Rect,this.bounds=new e.Rect(t.x,t.y,t.width,t.height),this.placement=t instanceof e.Point?n:e.OverlayPlacement.TOP_LEFT}}}(OpenSeadragon),function(e){function u(e){e.updateAgain=!1;var t,n,r=null,i=!1,s=+(new Date),u=e.viewport.getContainerSize(),f=e.viewport.getBounds(!0),l=f.getTopLeft(),h=f.getBottomRight(),p=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(0),!0).x,d=Math.max(e.source.minLevel,Math.floor(Math.log(e.minZoomImageRatio)/Math.log(2))),v=Math.min(e.source.maxLevel,Math.floor(Math.log(p/e.minPixelRatio)/Math.log(2))),g,y,b,w,E,S;while(e.lastDrawn.length>0)t=e.lastDrawn.pop(),t.beingDrawn=!1;e.canvas.innerHTML="",o&&(e.canvas.width=u.x,e.canvas.height=u.y,e.context.clearRect(0,0,u.x,u.y));if(!e.wrapHorizontal&&(h.x<0||l.x>1))return;if(!e.wrapVertical&&(h.y<0||l.y>e.normHeight))return;e.wrapHorizontal||(l.x=Math.max(l.x,0),h.x=Math.min(h.x,1)),e.wrapVertical||(l.y=Math.max(l.y,0),h.y=Math.min(h.y,e.normHeight)),d=Math.min(d,v);for(n=v;n>=d;n--){g=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(n),!0).x;if(!i&&g>=e.minPixelRatio||n==d)drawLevel=!0,i=!0;else if(!i)continue;y=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(n),!1).x,b=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(0),!1).x,w=e.immediateRender?1:b,E=Math.min(1,(g-.5)/.5),S=w/Math.abs(w-y),r=a(e,i,n,E,S,l,h,s,r);if(m(e.coverage,n))break}N(e,e.lastDrawn),x(e.viewport,e.overlays,e.container),r&&(c(e,r,s),e.updateAgain=!0)}function a(e,t,n,r,i,s,o,u,a){var l,c,h,p,d,v=e.viewport.pixelFromPoint(e.viewport.getCenter());h=e.source.getTileAtPoint(n,s),p=e.source.getTileAtPoint(n,o),d=e.source.getNumTiles(n),b(e.coverage,n),e.wrapHorizontal||(p.x=Math.min(p.x,d.x-1)),e.wrapVertical||(p.y=Math.min(p.y,d.y-1));for(l=h.x;l<=p.x;l++)for(c=h.y;c<=p.y;c++)a=f(e,drawLevel,t,l,c,n,r,i,v,d,u,a);return a}function f(e,t,n,r,i,s,o,u,a,f,c,h){var v=l(r,i,s,e.source,e.tilesMatrix,c,f,e.normHeight),m=t,b;return y(e.coverage,s,r,i,!1),v.exists?(n&&!m&&(g(e.coverage,s,r,i)?y(e.coverage,s,r,i,!0):m=!0),m?(p(v,e.source.tileOverlap,e.viewport,a,u),v.loaded?e.updateAgain=d(e,v,r,i,s,o,c):v.loading||(h=E(h,v)),h):h):h}function l(t,n,r,i,s,o,u,a){var f,l,c,h,p,d;return s[r]||(s[r]={}),s[r][t]||(s[r][t]={}),s[r][t][n]||(f=(u.x+t%u.x)%u.x,l=(u.y+n%u.y)%u.y,c=i.getTileBounds(r,f,l),h=i.tileExists(r,f,l),p=i.getTileUrl(r,f,l),c.x+=1*(t-f)/u.x,c.y+=a*(n-l)/u.y,s[r][t][n]=new e.Tile(r,t,n,c,h,p)),d=s[r][t][n],d.lastTouchTime=o,d}function c(e,t,n){t.loading=e.loadImage(t.url,function(r){h(e,t,n,r)})}function h(t,n,r,i){var s,o,u,a,f,l,c,h,p,d;n.loading=!1;if(t.midUpdate){e.console.warn("Tile load callback in middle of drawing routine.");return}if(!i){e.console.log("Tile %s failed to load: %s",n,n.url),n.exists=!1;return}if(r<t.lastResetTime){e.console.log("Ignoring tile %s loaded before reset: %s",n,n.url);return}n.loaded=!0,n.image=i,s=t.tilesLoaded.length;if(t.tilesLoaded.length>=t.maxImageCacheCount){o=Math.ceil(Math.log(t.source.tileSize)/Math.log(2)),u=null,l=-1;for(d=t.tilesLoaded.length-1;d>=0;d--){c=t.tilesLoaded[d];if(c.level<=t.cutoff||c.beingDrawn)continue;if(!u){u=c,l=d;continue}h=c.lastTouchTime,a=u.lastTouchTime,p=c.level,f=u.level;if(h<a||h==a&&p>f)u=c,l=d}u&&l>=0&&(u.unload(),s=l)}t.tilesLoaded[s]=n,t.updateAgain=!0}function p(t,n,r,i,s){var o=t.bounds.getTopLeft(),u=t.bounds.getSize(),a=r.pixelFromPoint(o,!0),f=r.pixelFromPoint(o,!1),l=r.deltaPixelsFromPoints(u,!0),c=r.deltaPixelsFromPoints(u,!1),h=f.plus(c.divide(2)),p=i.distanceTo(h);n||(l=l.plus(new e.Point(1,1))),t.position=a,t.size=l,t.distance=p,t.visibility=s}function d(e,t,n,r,i,s,o){var u=1e3*e.blendTime,a,f;t.blendStart||(t.blendStart=o),a=o-t.blendStart,f=Math.min(1,a/u),e.alwaysBlend&&(f*=s),t.opacity=f,e.lastDrawn.push(t);if(f==1)y(e.coverage,i,n,r,!0);else if(a<u)return!0;return!1}function v(e){e.tilesMatrix={},e.tilesLoaded=[]}function m(e,t,n,r){var i,s,o,u;if(!e[t])return!1;if(n===undefined||r===undefined){i=e[t];for(o in i)if(i.hasOwnProperty(o)){s=i[o];for(u in s)if(s.hasOwnProperty(u)&&!s[u])return!1}return!0}return e[t][n]===undefined||e[t][n][r]===undefined||e[t][n][r]===!0}function g(e,t,n,r){return n===undefined||r===undefined?m(e,t+1):m(e,t+1,2*n,2*r)&&m(e,t+1,2*n,2*r+1)&&m(e,t+1,2*n+1,2*r)&&m(e,t+1,2*n+1,2*r+1)}function y(t,n,r,i,s){if(!t[n]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n);return}t[n][r]||(t[n][r]={}),t[n][r][i]=s}function b(e,t){e[t]={}}function w(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n].element==t)return n;return-1}function E(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function S(e,t,n,r){e.onload=null,e.onabort=null,e.onerror=null,r&&window.clearTimeout(r),window.setTimeout(function(){t(e.src,n?e:null)},1)}function x(e,t,n){var r,i=t.length;for(r=0;r<i;r++)T(e,t[r],n)}function T(e,t,n){t.position=e.pixelFromPoint(t.bounds.getTopLeft(),!0),t.size=e.deltaPixelsFromPoints(t.bounds.getSize(),!0),t.drawHTML(n)}function N(e,t){var n,r;for(n=t.length-1;n>=0;n--)r=t[n],o?r.drawCanvas(e.context):r.drawHTML(e.canvas),r.beingDrawn=!0}var t=5e3,n=e.getWindowSize(),r=e.Browser.vendor,i=e.Browser.version,s=r==e.BROWSERS.FIREFOX||r==e.BROWSERS.OPERA||r==e.BROWSERS.SAFARI&&i>=4||r==e.BROWSERS.CHROME&&i>=2||r==e.BROWSERS.IE&&i>=9,o=s&&!(n.x<=400||n.y<=400)&&!navigator.appVersion.match("Mobile")&&e.isFunction(document.createElement("canvas").getContext);e.Drawer=function(t){var n=arguments,r;e.isPlainObject(t)||(t={source:n[0],viewport:n[1],element:n[2]}),e.extend(!0,this,{downloading:0,tilesMatrix:{},tilesLoaded:[],coverage:{},lastDrawn:[],lastResetTime:0,midUpdate:!1,updateAgain:!0,overlays:[],maxImageCacheCount:e.DEFAULT_SETTINGS.maxImageCacheCount,imageLoaderLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio},t),this.container=e.getElement(this.element),this.canvas=e.makeNeutralElement(o?"canvas":"div"),this.context=o?this.canvas.getContext("2d"):null,this.normHeight=this.source.dimensions.y/this.source.dimensions.x,this.element=this.container,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.container.style.textAlign="left",this.container.appendChild(this.canvas);for(r=0;r<this.overlays.length;r++)e.isPlainObject(this.overlays[r])?function(t,n){var i=document.createElement("a"),s=new e.Rect(n.x,n.y,n.width,n.height),o=Math.floor(Math.random()*1e7);i.href="#/overlay/"+o,i.id=o,i.className=n.className?n.className:"openseadragon-overlay",t.overlays[r]=new e.Overlay(i,s)}(this,this.overlays[r]):e.isFunction(this.overlays[r])},e.Drawer.prototype={addOverlay:function(t,n,r){t=e.getElement(t);if(w(this.overlays,t)>=0)return;this.overlays.push(new e.Overlay(t,n,r)),this.updateAgain=!0},updateOverlay:function(t,n,r){var i;t=e.getElement(t),i=w(this.overlays,t),i>=0&&(this.overlays[i].update(n,r),this.updateAgain=!0)},removeOverlay:function(t){var n;t=e.getElement(t),n=w(this.overlays,t),n>=0&&(this.overlays[n].destroy(),this.overlays.splice(n,1),this.updateAgain=!0)},clearOverlays:function(){while(this.overlays.length>0)this.overlays.pop().destroy(),this.updateAgain=!0},needsUpdate:function(){return this.updateAgain},numTilesLoaded:function(){return this.tilesLoaded.length},reset:function(){v(this),this.lastResetTime=+(new Date),this.updateAgain=!0},update:function(){this.midUpdate=!0,u(this),this.midUpdate=!1},loadImage:function(n,r){var i=this,s=!1,o,u,a;if(!this.imageLoaderLimit||this.downloading<this.imageLoaderLimit)this.downloading++,o=new Image,a=function(t){i.downloading--;if(typeof r=="function")try{r(o)}catch(s){e.console.error("%s while executing %s callback: %s",s.name,n,s.message,s)}},o.onload=function(){S(o,a,!0)},o.onabort=o.onerror=function(){S(o,a,!1)},u=window.setTimeout(function(){S(o,a,!1,u)},t),s=!0,o.src=n;return s}}}(OpenSeadragon),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical},t),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.resetContentSize(this.contentSize),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){this.contentSize=t,this.contentAspectX=this.contentSize.x/this.contentSize.y,this.contentAspectY=this.contentSize.y/this.contentSize.x,this.homeBounds=new e.Rect(0,0,1,this.contentAspectY),this.fitWidthBounds=new e.Rect(0,0,1,this.contentAspectX),this.fitHeightBounds=new e.Rect(0,0,1,this.contentAspectY)},getHomeZoom:function(){var e=Math.min(this.contentAspectX,this.contentAspectY)/this.getAspectRatio();return e>=1?1:e},getMinZoom:function(){var e=this.getHomeZoom();return zoom=this.minZoomImageRatio*e,Math.min(zoom,e)},getMaxZoom:function(){var e=this.contentSize.x*this.maxZoomPixelRatio/this.containerSize.x;return Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this.containerSize.x/this.containerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getBounds:function(t){var n=this.getCenter(t),r=1/this.getZoom(t),i=r/this.getAspectRatio();return new e.Rect(n.x-r/2,n.y-i/2,r,i)},getCenter:function(t){var n=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),r=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),i,s,o,u,a,f,l,c;return t?n:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),s=this.getZoom(),o=1/s,u=o/this.getAspectRatio(),a=new e.Rect(n.x-o/2,n.y-u/2,o,u),f=this.zoomPoint.minus(a.getTopLeft()).times(this.containerSize.x/a.width),l=f.minus(i),c=l.divide(this.containerSize.x*s),r.plus(c)):r},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},applyConstraints:function(e){var t=this.getZoom(),n=Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom()),r,i,s,o,u,a,f,l=0,c=0;t!=n&&this.zoomTo(n,this.zoomPoint,e),r=this.getBounds(),i=this.visibilityRatio*r.width,s=this.visibilityRatio*r.height,o=r.x+r.width,u=1-r.x,a=r.y+r.height,f=this.contentAspectY-r.y,this.wrapHorizontal||(o<i?l=i-o:u<i&&(l=u-i)),this.wrapVertical||(a<s?c=s-a:f<s&&(c=f-s));if(l||c)r.x+=l,r.y+=c,this.fitBounds(r,e)},ensureVisible:function(e){this.applyConstraints(e)},fitBounds:function(t,n){var r=this.getAspectRatio(),i=t.getCenter(),s=new e.Rect(t.x,t.y,t.width,t.height),o,u,a,f;s.getAspectRatio()>=r?(s.height=t.width/r,s.y=i.y-s.height/2):(s.width=t.height*r,s.x=i.x-s.width/2),this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),o=this.getBounds(),u=this.getZoom(),a=1/s.width;if(a==u||s.width==o.width){this.panTo(i,n);return}f=o.getTopLeft().times(this.containerSize.x/o.width).minus(s.getTopLeft().times(this.containerSize.x/s.width)).divide(this.containerSize.x/o.width-this.containerSize.x/s.width),this.zoomTo(a,f,n)},goHome:function(e){return this.fitVertically(e)},fitVertically:function(e){var t=this.getCenter();this.wrapHorizontal&&(t.x=(1+t.x%1)%1,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(this.contentAspectY+t.y%this.contentAspectY)%this.contentAspectY,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.homeBounds,e)},fitHorizontally:function(e){var t=this.getCenter();this.wrapHorizontal&&(t.x=(this.contentAspectX+t.x%this.contentAspectX)%this.contentAspectX,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(1+t.y%1)%1,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitWidthBounds,e)},panBy:function(t,n){var r=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);this.panTo(r.plus(t),n)},panTo:function(e,t){t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y))},zoomBy:function(e,t,n){this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,r){r?this.zoomSpring.resetTo(t):this.zoomSpring.springTo(t),this.zoomPoint=n instanceof e.Point?n:null},resize:function(t,n){var r=this.getBounds(),i=r,s=t.x/this.containerSize.x;this.containerSize=new e.Point(t.x,t.y),n&&(i.width=r.width*s,i.height=i.width/this.getAspectRatio()),this.fitBounds(i,!0)},update:function(){var e=this.centerSpringX.current.value,t=this.centerSpringY.current.value,n=this.zoomSpring.current.value,r,i,s,o;return this.zoomPoint&&(r=this.pixelFromPoint(this.zoomPoint,!0)),this.zoomSpring.update(),this.zoomPoint&&this.zoomSpring.current.value!=n?(i=this.pixelFromPoint(this.zoomPoint,!0),s=i.minus(r),o=this.deltaPointsFromPixels(s,!0),this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y)):this.zoomPoint=null,this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!=e||this.centerSpringY.current.value!=t||this.zoomSpring.current.value!=n},deltaPixelsFromPoints:function(e,t){return e.times(this.containerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.containerSize.x*this.getZoom(t))},pixelFromPoint:function(e,t){var n=this.getBounds(t);return e.minus(n.getTopLeft()).times(this.containerSize.x/n.width)},pointFromPixel:function(e,t){var n=this.getBounds(t);return e.divide(this.containerSize.x/n.width).plus(n.getTopLeft())}}}(OpenSeadragon);
